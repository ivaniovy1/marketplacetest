<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Futuristic Mini Marketplace — Demo</title>
  <!-- Tailwind CDN for quick styling (works in preview) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Extra small polished styles */
    body { background: radial-gradient(ellipse at 10% 10%, rgba(99,102,241,0.12), transparent 120px), #071025; color: #e6eef8; }
    .glass { backdrop-filter: blur(8px) saturate(120%); background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border: 1px solid rgba(255,255,255,0.06); }
    .accent { color: #7c3aed; }
    .draggable { cursor: move; touch-action: none; }
    .video-bg { position: absolute; inset:0; object-fit:cover; z-index:0; opacity:0.25; }
  </style>
</head>
<body class="min-h-screen antialiased relative overflow-hidden">
  <!-- Background video placeholder -->
  <video id="bgVideo" class="video-bg" autoplay muted loop playsinline></video>

  <div class="max-w-6xl mx-auto p-6 relative z-10">
    <header class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold accent">Futuristic Mini Marketplace</h1>
      <div class="flex gap-3 items-center">
        <button id="adminBtn" class="px-3 py-2 rounded-lg glass text-sm">Admin</button>
        <button id="regBtn" class="px-3 py-2 rounded-lg bg-violet-600/80 text-sm">Регистрация</button>
      </div>
    </header>

    <main class="grid grid-cols-3 gap-6">
      <!-- Left: Controls -->
      <section class="col-span-1 glass p-4 rounded-xl">
        <h2 class="text-lg font-semibold mb-2">Настройки аудио</h2>
        <div class="space-y-3">
          <label class="block text-xs">Громкость</label>
          <input id="volume" type="range" min="0" max="1" step="0.01" value="0.5" />

          <label class="block text-xs">Басс (эквалайзер)</label>
          <input id="bass" type="range" min="-30" max="30" step="1" value="0" />

          <label class="block text-xs">Мелодия (пример)</label>
          <select id="musicSelect" class="w-full text-black">
            <option value="sample1">Chill loop</option>
            <option value="sample2">Synth arps</option>
          </select>
        </div>

        <hr class="my-4 border-t border-white/6" />

        <h2 class="text-lg font-semibold mb-2">Внешний вид</h2>
        <div class="space-y-3">
          <label class="block text-xs">Шрифт</label>
          <select id="fontSelect" class="w-full text-black">
            <option value="Inter, system-ui, sans-serif">Inter</option>
            <option value="'Space Grotesk', sans-serif">Space Grotesk</option>
            <option value="'Roboto', sans-serif">Roboto</option>
          </select>

          <label class="block text-xs">Цвет акцента</label>
          <input id="accentColor" type="color" value="#8b5cf6" />
        </div>

        <hr class="my-4 border-t border-white/6" />

        <h2 class="text-lg font-semibold mb-2">Фон видео / картинка</h2>
        <input id="bgUpload" type="file" accept="video/*,image/*" class="w-full text-sm" />
        <p class="text-xs mt-2 text-white/60">Загрузите видео (mp4/webm) или картинку — будет использовано как фон.</p>
      </section>

      <!-- Center: Marketplace / Offers -->
      <section class="col-span-2 glass p-6 rounded-xl">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-semibold">Офферы</h2>
          <div class="flex gap-2 items-center">
            <input id="offerText" placeholder="Название оффера" class="px-3 py-2 rounded-lg text-black" />
            <button id="addOffer" class="px-3 py-2 bg-green-500 rounded-lg">Добавить</button>
          </div>
        </div>

        <div id="offers" class="grid grid-cols-2 gap-4"></div>

        <hr class="my-4 border-t border-white/6" />

        <h3 class="font-semibold mb-2">Перетащите изображение (drag) — можно двигать</h3>
        <div class="relative h-48 bg-white/3 rounded-xl flex items-center justify-center overflow-hidden">
          <img id="draggableImg" src="https://images.unsplash.com/photo-1544465540-67a2b6b4b7d6?q=80&w=800&auto=format&fit=crop&s=placeholder" alt="draggable" class="draggable max-h-40" style="transform:translate(0px,0px) scale(1);" />
        </div>
      </section>

      <!-- Bottom: Admin mockup / login -->
      <section class="col-span-3 glass p-4 rounded-xl mt-4">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="font-semibold">Панель администратора (демо)</h3>
            <p class="text-sm text-white/60">Нажмите Admin → Войти (пароль любой) — увидите список пользователей и возможность 'накрутить баланс'.</p>
          </div>
          <div class="text-right">
            <span class="text-xs text-white/60">Demo accounts: user1 (balance 100), user2 (balance 50)</span>
          </div>
        </div>

        <div id="adminPanel" class="hidden mt-4 border-t pt-4">
          <div class="flex gap-4">
            <div class="w-1/2">
              <h4 class="font-medium">Пользователи</h4>
              <ul id="userList" class="mt-2 space-y-2 text-sm"></ul>
            </div>
            <div class="w-1/2">
              <h4 class="font-medium">Действия</h4>
              <div class="mt-2 space-y-2">
                <input id="targetUser" placeholder="название пользователя" class="px-3 py-2 rounded-lg text-black w-full" />
                <input id="amount" type="number" placeholder="сумма" class="px-3 py-2 rounded-lg text-black w-full" />
                <button id="boostBtn" class="px-3 py-2 bg-amber-500 rounded-lg w-full">Накрутить баланс</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="mt-6 text-xs text-white/50">Сделано автоматически — однофайловый прототип. Настройте и подключите серверную часть при необходимости.</footer>
  </div>

  <!-- Admin Modal (simple) -->
  <div id="modal" class="fixed inset-0 hidden items-center justify-center z-50">
    <div class="w-full max-w-md p-6 glass rounded-xl">
      <h3 class="text-lg font-semibold mb-3">Вход администратора</h3>
      <input id="adminPass" type="password" placeholder="пароль" class="w-full px-3 py-2 rounded-lg text-black mb-3" />
      <div class="flex justify-end gap-2">
        <button id="modalCancel" class="px-3 py-2 rounded-lg">Отменить</button>
        <button id="modalOk" class="px-3 py-2 bg-violet-600 rounded-lg">Войти</button>
      </div>
    </div>
  </div>

  <script>
    // --- Simple in-memory demo data ---
    const users = [ { name: 'user1', balance: 100 }, { name: 'user2', balance: 50 } ];

    // --- UI elements ---
    const adminBtn = document.getElementById('adminBtn');
    const modal = document.getElementById('modal');
    const modalOk = document.getElementById('modalOk');
    const modalCancel = document.getElementById('modalCancel');
    const adminPanel = document.getElementById('adminPanel');
    const userList = document.getElementById('userList');
    const boostBtn = document.getElementById('boostBtn');
    const targetUser = document.getElementById('targetUser');
    const amount = document.getElementById('amount');

    // --- Audio: basic WebAudio with bass control ---
    let audioCtx, gainNode, bassFilter, audioEl, sourceNode;
    function setupAudio() {
      audioEl = new Audio();
      audioEl.loop = true;
      // small demo tone using WebAudio oscillator if no samples available
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      sourceNode = audioCtx.createMediaElementSource(audioEl);
      bassFilter = audioCtx.createBiquadFilter(); bassFilter.type = 'lowshelf'; bassFilter.frequency.value = 200;
      gainNode = audioCtx.createGain(); gainNode.gain.value = 0.5;
      sourceNode.connect(bassFilter).connect(gainNode).connect(audioCtx.destination);
      audioEl.src = ''; // set when user chooses sample
    }
    setupAudio();

    document.getElementById('volume').addEventListener('input', (e)=>{ if(gainNode) gainNode.gain.value = parseFloat(e.target.value); });
    document.getElementById('bass').addEventListener('input', (e)=>{ if(bassFilter) bassFilter.gain.value = parseFloat(e.target.value); });

    // sample selection: using base64 small audio could be embedded, but leave demo to user
    document.getElementById('musicSelect').addEventListener('change',(e)=>{
      const v = e.target.value;
      if(v==='sample1') { audioEl.src = ''; /* placeholder */ }
      if(audioCtx.state === 'suspended') audioCtx.resume();
      audioEl.play().catch(()=>{});
    });

    // --- Offers ---
    const offersEl = document.getElementById('offers');
    function renderUsers(){ userList.innerHTML = ''; users.forEach(u=>{ const li = document.createElement('li'); li.innerHTML = `<div class=\"flex justify-between bg-white/4 p-2 rounded\"><span>${u.name}</span><strong>${u.balance}</strong></div>`; userList.appendChild(li); }); }
    renderUsers();

    document.getElementById('addOffer').addEventListener('click', ()=>{
      const text = document.getElementById('offerText').value.trim();
      if(!text) return alert('Введите название оффера');
      const card = document.createElement('div');
      card.className = 'p-4 rounded-xl glass';
      card.innerHTML = `<h4 class=\"font-semibold\">${escapeHtml(text)}</h4><p class=\"text-xs text-white/60 mt-2\">Описание демо. Цена: 10</p><div class=\"mt-3 flex gap-2\"><button class=\"buyBtn px-3 py-2 bg-blue-500 rounded\">Купить</button></div>`;
      offersEl.prepend(card);
      document.getElementById('offerText').value = '';
    });

    function escapeHtml(s){ return s.replace(/[&<>\"]/g, c=>({ '&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;' }[c])); }

    // draggable image logic (pointer events)
    const img = document.getElementById('draggableImg');
    let dragging = false, startX=0, startY=0, offsetX=0, offsetY=0;
    img.addEventListener('pointerdown', (e)=>{ dragging=true; img.setPointerCapture(e.pointerId); startX=e.clientX; startY=e.clientY; const t = getTranslate(img); offsetX=t.x; offsetY=t.y; });
    window.addEventListener('pointermove',(e)=>{ if(!dragging) return; const dx=e.clientX-startX; const dy=e.clientY-startY; img.style.transform = `translate(${offsetX+dx}px, ${offsetY+dy}px)`; });
    window.addEventListener('pointerup',(e)=>{ dragging=false; try{ img.releasePointerCapture(e.pointerId);}catch(e){} });
    function getTranslate(el){ const st = window.getComputedStyle(el); const tr = st.transform || 'none'; if(tr==='none') return {x:0,y:0}; const m = tr.match(/matrix\((.+)\)/); if(!m) return {x:0,y:0}; const nums = m[1].split(',').map(Number); return { x: nums[4], y: nums[5] }; }

    // Admin modal handling
    adminBtn.addEventListener('click', ()=>{ modal.classList.remove('hidden'); modal.classList.add('flex'); });
    modalCancel.addEventListener('click', ()=>{ modal.classList.add('hidden'); modal.classList.remove('flex'); });
    modalOk.addEventListener('click', ()=>{ const pw = document.getElementById('adminPass').value; // demo: any pw works
      modal.classList.add('hidden'); modal.classList.remove('flex'); adminPanel.classList.toggle('hidden'); renderUsers();
    });

    boostBtn.addEventListener('click', ()=>{
      const name = targetUser.value.trim(); const amt = Number(amount.value);
      if(!name || !amt) return alert('Введите пользователя и сумму');
      const u = users.find(x=>x.name===name);
      if(u) { u.balance += amt; alert('Готово — баланс обновлён'); } else { users.push({ name, balance: amt }); alert('Создан пользователь и обновлён баланс'); }
      renderUsers();
    });

    // Background upload handler (video or image)
    const bgUpload = document.getElementById('bgUpload');
    const bgVideo = document.getElementById('bgVideo');
    bgUpload.addEventListener('change', (e)=>{
      const f = e.target.files[0]; if(!f) return;
      const url = URL.createObjectURL(f);
      if(f.type.startsWith('video/')){ bgVideo.src = url; bgVideo.style.opacity = 0.35; bgVideo.play().catch(()=>{}); }
      else if(f.type.startsWith('image/')){
        // convert image to data URL and set as video background fallback via CSS
        document.body.style.backgroundImage = `url(${url})`; document.body.style.backgroundSize = 'cover';
      }
    });

    // Font & accent color changes live
    document.getElementById('fontSelect').addEventListener('change', (e)=>{ document.documentElement.style.setProperty('--demo-font', e.target.value); document.body.style.fontFamily = e.target.value; });
    document.getElementById('accentColor').addEventListener('input', (e)=>{ document.querySelectorAll('.accent').forEach(el=>el.style.color = e.target.value); document.querySelectorAll('.glass').forEach(el=>el.style.borderColor = hexToRgba(e.target.value, 0.08)); });
    function hexToRgba(hex, alpha){ const c = hex.replace('#',''); const bigint = parseInt(c,16); const r=(bigint>>16)&255; const g=(bigint>>8)&255; const b=bigint&255; return `rgba(${r},${g},${b},${alpha})`; }

    // Small helpers
    // Allow registration button to create a demo user
    document.getElementById('regBtn').addEventListener('click', ()=>{
      const name = prompt('Придумайте имя'); if(!name) return; users.push({ name, balance: 0 }); alert('Готово — пользователь создан'); renderUsers();
    });

    // Basic persistence (localStorage) for offers and position
    window.addEventListener('beforeunload', ()=>{
      try{ localStorage.setItem('users_demo', JSON.stringify(users)); }catch(e){}
    });
    // restore
    try{ const saved = JSON.parse(localStorage.getItem('users_demo')||'null'); if(saved && Array.isArray(saved)) { users.length=0; users.push(...saved); renderUsers(); } }catch(e){}

    // Accessibility: keyboard toggle admin with A
    window.addEventListener('keydown',(e)=>{ if(e.key.toLowerCase()==='a' && (e.ctrlKey || e.metaKey)) adminPanel.classList.toggle('hidden'); });

    // End of script
  </script>
</body>
</html>
